analyze_query:
  description: |
    Analiza la consulta ORIGINAL del usuario sobre biodescodificación para entenderla,
    pero SIN inventar ni añadir síntomas nuevos.

    Instrucciones:
    1. Trabaja SIEMPRE en español.
    2. Usa únicamente el texto de la consulta proporcionada ({query}).
    3. NO inventes ni añadas síntomas adicionales, ejemplos ni casos ficticios.
    4. Extrae del diccionario proporcionado en json:
       - Síntoma principal (o síntomas principales) tal como aparecen en la consulta.
       - Partes del cuerpo implicadas (si se mencionan).
       - Emociones o situaciones asociadas solo si el usuario las menciona explícitamente.
       - "definicion", "tecnico", "sentido_biologico" y "conflicto"
    5. Devuelve un resumen estructurado que pueda usarse para buscar en el diccionario.

    Input: Consulta en lenguaje natural del usuario: {query}
    Output: Parámetros refinados de búsqueda basados EXCLUSIVAMENTE en la consulta del usuario.
  agent: query_analyzer
  expected_output: |
    Un resumen breve en español que contenga:
    - Síntoma principal
    - Parte del cuerpo implicada (si se menciona)
    - Palabras clave que deban usarse para buscar en el diccionario
    - CERO síntomas inventados o añadidos.

search_dictionary:
  description: |
    Usando los tools disponibles, busca en el diccionario de biodescodificación
    dentro del archivo JSON procesado las entradas más relevantes para la consulta
    ORIGINAL del usuario en español: {query}, y si es útil, también las palabras
    clave extraídas en la tarea de análisis de consulta.

    Instrucciones:
    1. NO inventes nuevos síntomas ni consultas.
    2. Usa principalmente los términos de la consulta del usuario, por ejemplo:
       - vértigo
       - miedo a las alturas
       - oído interno
    3. Usa el tool de búsqueda para encontrar entradas cuyo "termino",
       "definicion", "tecnico", "sentido_biologico" o "conflicto" estén
       relacionados con la consulta.
  agent: dictionary_navigator
  expected_output: |
    Lista de entradas del diccionario relevantes (en JSON), limitada a las más importantes.

score_relevance:
  description: |
    Ordena y filtra los resultados de búsqueda en función de su relevancia
    con respecto a la consulta.

    Factores de puntuación:
    1. Coincidencias directas de palabras clave
    2. Similitud semántica
    3. Contexto de la entrada
    4. Complejidad de la entrada
    5. Frecuencia en el diccionario

    Input: Resultados de búsqueda en bruto del Dictionary Navigation Expert
    Output: Lista ordenada de entradas relevantes
  agent: relevance_scorer
  expected_output: |
    Resultados de búsqueda ordenados con:
    - Puntuaciones de cada entrada
    - Orden de relevancia
    - Nivel de confianza
    - Metodología de puntuación

expand_query:
  description: |
    Expande la consulta original con sinónimos y términos relacionados para mejorar la cobertura.

    Técnicas:
    1. Expansión con sinónimos
    2. Identificación de conceptos relacionados
    3. Expansión con vocabulario de dominio
    4. Exploración de redes semánticas

    Input: Consulta original y resultados actuales
    Output: Consulta ampliada con términos adicionales
  agent: synonym_expander
  expected_output: |
    Consulta ampliada con:
    - Sinónimos
    - Términos relacionados
    - Expansiones de concepto
    - Conexiones semánticas

adapt_context:
  description: |
    Adapta la estrategia de búsqueda en función del historial de conversación
    y de la sesión del usuario.

    Aspectos a considerar:
    1. Consultas previas en la sesión
    2. Patrones de interacción del usuario
    3. Comprensión contextual
    4. Necesidades de personalización

    Input: Consulta actual e historial de sesión
    Output: Adaptación de la búsqueda sensible al contexto
  agent: context_manager
  expected_output: |
    Parámetros de búsqueda adaptados al contexto con:
    - Historial de sesión
    - Ajustes de personalización
    - Estrategias adaptativas
    - Patrones detectados

validate_results:
  description: |
    Valida la calidad y la exactitud de los resultados de búsqueda.

    Pasos de validación:
    1. Comprobación de consistencia
    2. Verificación de exactitud
    3. Control de calidad
    4. Confirmación de relevancia

    Input: Resultados finales ordenados
    Output: Resultados validados y con garantía de calidad
  agent: validator
  expected_output: |
    Resultados de búsqueda validados con:
    - Puntuaciones de calidad
    - Verificación de exactitud
    - Comprobaciones de consistencia
    - Nivel de confianza final

generate_answer:
  description: |
    A partir de la consulta del usuario en español ({query}) y de las
    entradas del diccionario obtenidas por las tareas anteriores,
    genera una explicación clara y estructurada.

    Instrucciones:
    1. Trabaja SIEMPRE en español.
    2. NO inventes nuevos síntomas ni casos; habla SOLO del síntoma que el
       usuario ha expresado extrayendo directamente las respuetas de las 
       entradas del diccionario proporcionadas.
    3. Usa principalmente las entradas más relacionadas con la consulta, por ejemplo:
       - VÉRTIGO
       - MIEDO a las ALTURAS
       - OÍDO INTERNO
    4. Para cada entrada relevante:
       - Primero muestra la entrada completa. Luego:
       - Resume brevemente 'definicion'.
       - Explica en lenguaje sencillo 'tecnico'.
       - Explica el 'sentido_biologico'.
       - Resume el 'conflicto' en términos emocionales comprensibles.
    5. Usa el campo 'referencias_cruzadas' para ampliar la respuesta:
       - Si hay pocas entradas y el texto no es muy largo, puedes integrar de forma breve
         las referencias cruzadas dentro de la explicación.
       - Si la respuesta se vuelve muy extensa, ENUMERA las referencias cruzadas al final
         como lista de temas que el usuario puede explorar por separado.
    6. Si encuentras varias entradas relacionadas (como VÉRTIGO, MIEDO a las ALTURAS,
       ACROFOBIA, OÍDO INTERNO), explica primero la que más coincide con el síntoma central
       y luego menciona las demás como posibles matices o temas relacionados.
    7. Termina SIEMPRE con un aviso claro de que esta información NO sustituye
       diagnóstico ni tratamiento médico profesional.

    Formato sugerido:
    1. Breve resumen del síntoma del usuario.
    2. Explicación principal según biodescodificación (entrada más relevante).
    3. Otros matices relacionados (otras entradas relevantes).
    4. Lista de referencias cruzadas para que el usuario pueda seguir investigando.
    5. Aviso de responsabilidad (no es consejo médico).

    Si no encuentras nada realmente relacionado, dilo explícitamente y
    sugiere reformular la pregunta o consultar a un profesional.
  agent: explainer
  expected_output: |
    Explicación en texto corrido en español, bien estructurada, que
    integre la información de las entradas del diccionario y la
    consulta del usuario, terminando con un aviso de que no es
    consejo médico.
  context:
    - analyze_query_task
    - search_dictionary_task
    - score_relevance_task
    - adapt_context_task
    - validate_results_task
